# Monitoring configuration for Athena Langfuse Recommendation Step Monitoring
version: "1.0"
name: "athena_recommendation_monitor"
environment: "${ENVIRONMENT:-production}"

# Scored items store (deduplication)
scored_store:
  type: db

# Schedule configuration (used by MonitoringScheduler)
schedule:
  interval_minutes: 3

# Source configuration
source:
  type: langfuse
  name: "athena"
  component: "recommendation"
  eval_mode: "online"
  environment: "${ENVIRONMENT:-production}"
  extractor: "implementations.athena.extractors.extract_recommendation"
  prompt_patterns: "implementations.athena.langfuse.prompt_patterns.WorkflowPromptPatterns"
  limit: 10
  minutes_back: 10
  tags: ["production"]
  timeout: 60
  fetch_full_traces: true
  show_progress: true

# Sampling strategy
sampling:
  strategy: all
  n: 10
  seed: 42

# Metrics configuration
metrics_config:
  UnderwritingFaithfulness:
    class: "underwriting_faithfulness"
    # llm_provider: 'openai'
    # model_name: 'gpt-4o'
    verification_mode: 'heuristic_then_llm'

# Publishing configuration
publishing:
  push_to_db: true
  push_to_langfuse: false
  trace_experiment: false

  # Database upload configuration (used when push_to_db: true)
  database:
    connection_string: "postgresql://mattevanoff@localhost:5432/eval"  # Override DATABASE_URL env var
    on_conflict: do_nothing  # do_nothing | upsert | error
    chunk_size: 1000         # Rows per batch upload

  experiment:
    enabled: false
    dataset_name: "development"
    run_name: "online-${environment}"
    link_to_traces: false
