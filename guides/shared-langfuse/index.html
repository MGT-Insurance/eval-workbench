
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Evaluation tooling and metrics for agent workflows">
      
      
      
      
        <link rel="prev" href="../athena-langfuse/">
      
      
        <link rel="next" href="../monitoring/">
      
      
        
      
      
      <link rel="icon" href="../../assets/mountains-light.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Langfuse (Shared) - Eval Workbench</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#langfuse-integration-shared" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Eval Workbench" class="md-header__button md-logo" aria-label="Eval Workbench" data-md-component="logo">
      
  <img src="../../assets/mountains-light.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eval Workbench
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Langfuse (Shared)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MGT-Insurance/eval-workbench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../metric-registry/" class="md-tabs__link">
          
  
  
    
  
  Metric Registry

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../deep-dives/" class="md-tabs__link">
          
  
  
    
  
  Deep Dives

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Eval Workbench" class="md-nav__button md-logo" aria-label="Eval Workbench" data-md-component="logo">
      
  <img src="../../assets/mountains-light.svg" alt="logo">

    </a>
    Eval Workbench
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MGT-Insurance/eval-workbench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../getting-started/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../athena-langfuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Langfuse (Athena)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Langfuse (Shared)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Langfuse (Shared)
  

    
  </span>
  
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#langfusesettings" class="md-nav__link">
    <span class="md-ellipsis">
      
        LangfuseSettings
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#langfusepromptmanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        LangfusePromptManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LangfusePromptManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-and-updating-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating and Updating Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetching-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fetching Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling-prompts-with-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compiling Prompts with Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Invalidation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change Notifications
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smartaccess-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartAccess Framework
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SmartAccess Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smartaccess-base-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartAccess (Base Class)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzy-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fuzzy Matching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smartdict" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartDict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smartobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartObject
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trace-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trace Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracestep" class="md-nav__link">
    <span class="md-ellipsis">
      
        TraceStep
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracecollection" class="md-nav__link">
    <span class="md-ellipsis">
      
        TraceCollection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promptpatternsbase" class="md-nav__link">
    <span class="md-ellipsis">
      
        PromptPatternsBase
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PromptPatternsBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-custom-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Custom Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helper Function
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webhook-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webhook Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Webhook Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature Verification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slack-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slack Alerts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utility Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse_chat_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_chat_transcript
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prompt-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trace-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-trace-navigation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deep Trace Navigation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exports
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring Config (YAML)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Slack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metric-registry/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Metric Registry
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Metric Registry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metric-registry/shared/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Shared
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Shared
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metric-registry/shared/slack/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Slack
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Slack
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/acceptance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acceptance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/composite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Composite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/engagement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engagement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/escalation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Escalation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/frustration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frustration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/intervention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intervention
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/override/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Override
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/override_satisfaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Override Satisfaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/recommendation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recommendation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/resolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/sentiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sentiment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/shared/slack/slack_compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Slack Compliance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metric-registry/athena/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Athena
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Athena
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metric-registry/athena/recommendation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Recommendation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3_2" id="__nav_4_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Recommendation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/citation_accuracy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Citation Accuracy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/citation_fidelity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Citation Fidelity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/decision_quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Quality
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/refer_reason/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Refer Reason
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/underwriting_completeness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Underwriting Completeness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/underwriting_faithfulness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Underwriting Faithfulness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric-registry/athena/recommendation/underwriting_rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Underwriting Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../deep-dives/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Deep Dives
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deep Dives
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dives/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dives/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#langfusesettings" class="md-nav__link">
    <span class="md-ellipsis">
      
        LangfuseSettings
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#langfusepromptmanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        LangfusePromptManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LangfusePromptManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-and-updating-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating and Updating Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetching-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fetching Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling-prompts-with-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compiling Prompts with Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Invalidation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change Notifications
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smartaccess-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartAccess Framework
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SmartAccess Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smartaccess-base-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartAccess (Base Class)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzy-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fuzzy Matching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smartdict" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartDict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smartobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        SmartObject
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trace-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trace Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracestep" class="md-nav__link">
    <span class="md-ellipsis">
      
        TraceStep
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracecollection" class="md-nav__link">
    <span class="md-ellipsis">
      
        TraceCollection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promptpatternsbase" class="md-nav__link">
    <span class="md-ellipsis">
      
        PromptPatternsBase
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PromptPatternsBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-custom-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Custom Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helper Function
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webhook-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webhook Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Webhook Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature Verification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slack-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slack Alerts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utility Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse_chat_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_chat_transcript
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prompt-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trace-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-trace-navigation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deep Trace Navigation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exports
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="langfuse-integration-shared">Langfuse Integration (Shared)<a class="headerlink" href="#langfuse-integration-shared" title="Permanent link">&para;</a></h1>
<p>The shared Langfuse module provides prompt management, trace handling, and
webhook integration for LLM observability. It enables intelligent access to
prompts and traces with smart dot-notation access patterns.</p>
<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                   LangfusePromptManager                         │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ • create_or_update_prompt()  [→ PromptClient]           │   │
│  │ • get_prompt()               [→ PromptClient + caching] │   │
│  │ • get_compiled_prompt()      [→ str|List with variables]│   │
│  │ • get_template()             [→ raw template]           │   │
│  └──────────────────────────────────────────────────────────┘   │
│  • mark_prompt_as_stale(name)                                    │
│  • notify_prompt_change(name, payload)                           │
│  • on_prompt_change(listener) [registers callback]               │
└─────────────────────────────────────────────────────────────────┘
                             ↕
┌─────────────────────────────────────────────────────────────────┐
│                    Webhook Handler                              │
│  POST /webhooks/langfuse                                        │
│  • verify_signature()  [HMAC-SHA256]                            │
│  • Handles: prompt.{created,updated,deleted}                    │
│  • Marks stale → Notifies listeners → Posts Slack alerts        │
└─────────────────────────────────────────────────────────────────┘
                             ↕
┌─────────────────────────────────────────────────────────────────┐
│              Trace Access &amp; Analysis (trace.py)                 │
│                                                                 │
│  Trace(trace_data, prompt_patterns)                             │
│   ├─ trace.recommendation  → TraceStep                          │
│   │   ├─ step.generation   → ObservationsView                   │
│   │   ├─ step.context      → ObservationsView                   │
│   │   └─ step.variables    → Dict[extracted variables]          │
│   ├─ trace.id              → trace attribute                    │
│   └─ trace.latency         → trace attribute                    │
│                                                                 │
│  SmartAccess Framework (dot-notation + fuzzy matching)          │
│   ├─ SmartDict (dict wrapper)                                   │
│   ├─ SmartObject (object wrapper)                               │
│   └─ Recursive wrapping of nested structures                    │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>
<hr />
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="langfusesettings">LangfuseSettings<a class="headerlink" href="#langfusesettings" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LangfuseSettings</span><span class="p">(</span><span class="n">RepoSettingsBase</span><span class="p">):</span>
    <span class="c1"># API Credentials</span>
    <span class="n">langfuse_public_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">langfuse_secret_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">langfuse_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Prompt Management</span>
    <span class="n">langfuse_default_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span>
    <span class="n">langfuse_default_cache_ttl_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>

    <span class="c1"># Webhook Configuration</span>
    <span class="n">langfuse_webhook_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">langfuse_webhook_notify_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Slack Alerts</span>
    <span class="n">langfuse_slack_channel_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">langfuse_slack_request_timeout_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">langfuse_slack_retry_max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">langfuse_slack_retry_backoff_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">langfuse_slack_retry_max_backoff_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>langfuse_default_label</code></td>
<td><code>"production"</code></td>
<td>Default prompt label</td>
</tr>
<tr>
<td><code>langfuse_default_cache_ttl_seconds</code></td>
<td><code>60</code></td>
<td>Local cache duration</td>
</tr>
<tr>
<td><code>langfuse_slack_request_timeout_seconds</code></td>
<td><code>10</code></td>
<td>Slack API timeout</td>
</tr>
<tr>
<td><code>langfuse_slack_retry_max_attempts</code></td>
<td><code>3</code></td>
<td>Retry count for Slack</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="langfusepromptmanager">LangfusePromptManager<a class="headerlink" href="#langfusepromptmanager" title="Permanent link">&para;</a></h2>
<p>Central manager for all Langfuse prompt operations including CRUD, caching,
invalidation, and change notifications.</p>
<h3 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.prompt</span><span class="w"> </span><span class="kn">import</span> <span class="n">LangfusePromptManager</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">LangfusePromptManager</span><span class="p">(</span>
    <span class="n">public_key</span><span class="o">=</span><span class="s2">&quot;pk-...&quot;</span><span class="p">,</span>      <span class="c1"># Optional, uses env if not provided</span>
    <span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;sk-...&quot;</span><span class="p">,</span>      <span class="c1"># Optional, uses env if not provided</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span>       <span class="c1"># Optional, uses env if not provided</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="creating-and-updating-prompts">Creating and Updating Prompts<a class="headerlink" href="#creating-and-updating-prompts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_or_update_prompt</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">prompt_content</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
    <span class="n">prompt_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>           <span class="c1"># &quot;text&quot; or &quot;chat&quot;</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptClient</span>
</code></pre></div>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Text prompt</span>
<span class="n">manager</span><span class="o">.</span><span class="n">create_or_update_prompt</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;recommendation&quot;</span><span class="p">,</span>
    <span class="n">prompt_content</span><span class="o">=</span><span class="s2">&quot;Analyze this case: {{ case_data }}&quot;</span><span class="p">,</span>
    <span class="n">prompt_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="s2">&quot;v2&quot;</span><span class="p">],</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Chat prompt</span>
<span class="n">manager</span><span class="o">.</span><span class="n">create_or_update_prompt</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;chat_assistant&quot;</span><span class="p">,</span>
    <span class="n">prompt_content</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ user_message }}&quot;</span><span class="p">},</span>
    <span class="p">],</span>
    <span class="n">prompt_type</span><span class="o">=</span><span class="s2">&quot;chat&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;production&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></p>
<h3 id="fetching-prompts">Fetching Prompts<a class="headerlink" href="#fetching-prompts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_prompt</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cache_ttl_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">retry_backoff_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptClient</span>
</code></pre></div>
<p><strong>Behavior:</strong>
- Defaults to "production" label if version/label omitted
- Checks <code>_stale_prompts</code> and bypasses cache if flagged
- Implements exponential backoff retry logic</p>
<h3 id="compiling-prompts-with-variables">Compiling Prompts with Variables<a class="headerlink" href="#compiling-prompts-with-variables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_compiled_prompt</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">fallback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">required_variables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">strict_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="n">fallback_on_compile_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">render_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span>
</code></pre></div>
<p><strong>Strict Mode Options:</strong>
- <code>"template"</code>: Check for unrendered placeholders after compilation
- <code>"required"</code>: Verify required_variables are present before compilation
- <code>"none"</code>: Skip all strict checks</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">compiled</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_compiled_prompt</span><span class="p">(</span>
    <span class="s2">&quot;recommendation&quot;</span><span class="p">,</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;case_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="s2">&quot;assessment&quot;</span><span class="p">:</span> <span class="s2">&quot;high-risk&quot;</span><span class="p">},</span>
    <span class="n">strict_mode</span><span class="o">=</span><span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="n">fallback</span><span class="o">=</span><span class="s2">&quot;Default prompt text&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></p>
<h3 id="cache-invalidation">Cache Invalidation<a class="headerlink" href="#cache-invalidation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Mark prompt for immediate refresh on next fetch</span>
<span class="n">manager</span><span class="o">.</span><span class="n">mark_prompt_as_stale</span><span class="p">(</span><span class="s2">&quot;recommendation&quot;</span><span class="p">)</span>

<span class="c1"># Promote specific version to labels</span>
<span class="n">manager</span><span class="o">.</span><span class="n">promote_version</span><span class="p">(</span><span class="s2">&quot;recommendation&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;production&quot;</span><span class="p">])</span>
</code></pre></div>
<h3 id="change-notifications">Change Notifications<a class="headerlink" href="#change-notifications" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Register listener</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_update</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prompt </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> updated: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">manager</span><span class="o">.</span><span class="n">on_prompt_change</span><span class="p">(</span><span class="n">on_update</span><span class="p">)</span>

<span class="c1"># Manually trigger notifications</span>
<span class="n">manager</span><span class="o">.</span><span class="n">notify_prompt_change</span><span class="p">(</span><span class="s2">&quot;recommendation&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
</code></pre></div>
<hr />
<h2 id="smartaccess-framework">SmartAccess Framework<a class="headerlink" href="#smartaccess-framework" title="Permanent link">&para;</a></h2>
<p>The SmartAccess system enables intelligent dot-notation access with fuzzy
matching across trace data.</p>
<h3 id="smartaccess-base-class">SmartAccess (Base Class)<a class="headerlink" href="#smartaccess-base-class" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SmartAccess</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dot-notation with 2-step fallback:</span>
<span class="sd">        1. Exact match via _lookup(key)</span>
<span class="sd">        2. Fuzzy match via _lookup_insensitive(key)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursively wrap results:</span>
<span class="sd">        - dict → SmartDict</span>
<span class="sd">        - list → list of wrapped items</span>
<span class="sd">        - object → SmartObject</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="fuzzy-matching">Fuzzy Matching<a class="headerlink" href="#fuzzy-matching" title="Permanent link">&para;</a></h3>
<p>Keys are normalized for case/separator-insensitive matching:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_normalize_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Examples:</span>
<span class="c1"># &quot;product_type&quot; matches &quot;productType&quot;</span>
<span class="c1"># &quot;CaseAssessment&quot; matches &quot;caseassessment&quot;</span>
</code></pre></div>
<h3 id="smartdict">SmartDict<a class="headerlink" href="#smartdict" title="Permanent link">&para;</a></h3>
<p>Dictionary wrapper with dot-notation and fuzzy key matching.</p>
<div class="highlight"><pre><span></span><code><span class="n">smart_dict</span> <span class="o">=</span> <span class="n">SmartDict</span><span class="p">({</span><span class="s2">&quot;productType&quot;</span><span class="p">:</span> <span class="s2">&quot;insurance&quot;</span><span class="p">,</span> <span class="s2">&quot;caseId&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">})</span>
<span class="n">smart_dict</span><span class="o">.</span><span class="n">product_type</span>  <span class="c1"># &quot;insurance&quot; (fuzzy match)</span>
<span class="n">smart_dict</span><span class="o">.</span><span class="n">case_id</span>       <span class="c1"># &quot;123&quot; (fuzzy match)</span>
<span class="n">smart_dict</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>     <span class="c1"># Returns raw dictionary</span>
</code></pre></div>
<h3 id="smartobject">SmartObject<a class="headerlink" href="#smartobject" title="Permanent link">&para;</a></h3>
<p>Generic object wrapper ensuring attributes return Smart wrappers.</p>
<div class="highlight"><pre><span></span><code><span class="n">smart_obj</span> <span class="o">=</span> <span class="n">SmartObject</span><span class="p">(</span><span class="n">some_object</span><span class="p">)</span>
<span class="n">smart_obj</span><span class="o">.</span><span class="n">nested_attr</span><span class="o">.</span><span class="n">deep_value</span>  <span class="c1"># Recursive wrapping</span>
</code></pre></div>
<hr />
<h2 id="trace-classes">Trace Classes<a class="headerlink" href="#trace-classes" title="Permanent link">&para;</a></h2>
<h3 id="trace">Trace<a class="headerlink" href="#trace" title="Permanent link">&para;</a></h3>
<p>Main entry point for accessing trace data with smart dot-notation navigation.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Trace</span><span class="p">(</span><span class="n">SmartAccess</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trace_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">prompt_patterns</span><span class="p">:</span> <span class="n">PromptPatternsBase</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">PromptPatternsBase</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
<p><strong>Access Patterns:</strong></p>
<table>
<thead>
<tr>
<th>Access</th>
<th>Returns</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>trace.{step_name}</code></td>
<td><code>TraceStep</code></td>
<td>Named workflow step</td>
</tr>
<tr>
<td><code>trace.id</code></td>
<td><code>str</code></td>
<td>Trace identifier</td>
</tr>
<tr>
<td><code>trace.latency</code></td>
<td><code>int</code></td>
<td>Execution time</td>
</tr>
<tr>
<td><code>trace.name</code></td>
<td><code>str</code></td>
<td>Trace name</td>
</tr>
</tbody>
</table>
<h3 id="tracestep">TraceStep<a class="headerlink" href="#tracestep" title="Permanent link">&para;</a></h3>
<p>Represents a named workflow step (e.g., "recommendation") with observations.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TraceStep</span><span class="p">(</span><span class="n">SmartAccess</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>                              <span class="c1"># Step name</span>
    <span class="n">observations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ObservationsView</span><span class="p">]</span>   <span class="c1"># Observations in step</span>
    <span class="n">prompt_patterns</span><span class="p">:</span> <span class="n">PromptPatternsBase</span>    <span class="c1"># Pattern registry</span>
</code></pre></div>
<p><strong>Properties:</strong></p>
<table>
<thead>
<tr>
<th>Access</th>
<th>Returns</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>step.variables</code></td>
<td><code>Dict[str, str]</code></td>
<td>Lazily extracted prompt variables</td>
</tr>
<tr>
<td><code>step.generation</code></td>
<td><code>ObservationsView</code></td>
<td>GENERATION observation</td>
</tr>
<tr>
<td><code>step.context</code></td>
<td><code>ObservationsView</code></td>
<td>SPAN observation (alias)</td>
</tr>
<tr>
<td><code>step.span</code></td>
<td><code>ObservationsView</code></td>
<td>SPAN observation</td>
</tr>
</tbody>
</table>
<h3 id="tracecollection">TraceCollection<a class="headerlink" href="#tracecollection" title="Permanent link">&para;</a></h3>
<p>Container for multiple traces with filtering and iteration.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TraceCollection</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">prompt_patterns</span><span class="p">:</span> <span class="n">PromptPatternsBase</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">PromptPatternsBase</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Trace</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Trace</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TraceCollection</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="n">traces</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">(</span><span class="n">trace_list</span><span class="p">,</span> <span class="n">prompt_patterns</span><span class="o">=</span><span class="n">WorkflowPromptPatterns</span><span class="p">)</span>

<span class="c1"># Filter</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="n">traces</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;athena&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;completed&quot;</span><span class="p">)</span>

<span class="c1"># Iterate</span>
<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">recommendation</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
</code></pre></div></p>
<hr />
<h2 id="promptpatternsbase">PromptPatternsBase<a class="headerlink" href="#promptpatternsbase" title="Permanent link">&para;</a></h2>
<p>Registry for regex extraction patterns. Enables custom pattern definitions per
workflow.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PromptPatternsBase</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_for</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks for method: _patterns_{step_name_lowercase}()</span>
<span class="sd">        Returns: Dict[pattern_name: pattern_regex]</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="creating-custom-patterns">Creating Custom Patterns<a class="headerlink" href="#creating-custom-patterns" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">PromptPatternsBase</span><span class="p">,</span> <span class="n">create_extraction_pattern</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomPromptPatterns</span><span class="p">(</span><span class="n">PromptPatternsBase</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_patterns_recommendation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;caseAssessment&quot;</span><span class="p">:</span> <span class="n">create_extraction_pattern</span><span class="p">(</span>
                <span class="s2">&quot;CASE ASSESSMENT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CONTEXT DATA&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;contextData&quot;</span><span class="p">:</span> <span class="n">create_extraction_pattern</span><span class="p">(</span>
                <span class="s2">&quot;CONTEXT DATA&quot;</span><span class="p">,</span>
                <span class="s2">&quot;(?:$)&quot;</span>  <span class="c1"># End of text</span>
            <span class="p">),</span>
        <span class="p">}</span>
</code></pre></div>
<h3 id="helper-function">Helper Function<a class="headerlink" href="#helper-function" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_extraction_pattern</span><span class="p">(</span><span class="n">start_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates regex: escaped(Start) → (Content) → End</span>

<span class="sd">    Example:</span>
<span class="sd">        create_extraction_pattern(&quot;CONTEXT:&quot;, &quot;FLAGS:&quot;)</span>
<span class="sd">        → r&quot;CONTEXT:\s*(.*?)\s*(?:FLAGS:)&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<hr />
<h2 id="webhook-handler">Webhook Handler<a class="headerlink" href="#webhook-handler" title="Permanent link">&para;</a></h2>
<p>The webhook handler processes Langfuse prompt update events.</p>
<h3 id="endpoint">Endpoint<a class="headerlink" href="#endpoint" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>POST /webhooks/langfuse
Header: X-Langfuse-Signature: t=&lt;timestamp&gt;,v1=&lt;signature&gt;
</code></pre></div>
<h3 id="signature-verification">Signature Verification<a class="headerlink" href="#signature-verification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_signature</span><span class="p">(</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
    <span class="n">signature_header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifies HMAC-SHA256 signature.</span>
<span class="sd">    Supports both timestamped and non-timestamped formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="event-handling">Event Handling<a class="headerlink" href="#event-handling" title="Permanent link">&para;</a></h3>
<p><strong>Supported Events:</strong>
- <code>prompt.created</code> - New prompt created
- <code>prompt.updated</code> - Existing prompt modified
- <code>prompt.deleted</code> - Prompt removed</p>
<p><strong>Processing Flow:</strong>
1. Verify HMAC signature
2. Parse JSON payload
3. Extract prompt name
4. Mark prompt as stale in manager
5. Notify registered listeners
6. Notify external services (if configured)
7. Post Slack alert (async, non-blocking)</p>
<h3 id="slack-alerts">Slack Alerts<a class="headerlink" href="#slack-alerts" title="Permanent link">&para;</a></h3>
<p>When configured, posts formatted alerts to Slack on prompt changes:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Requires environment variables:</span>
<span class="c1"># LANGFUSE_SLACK_CHANNEL_ID - Target Slack channel</span>
<span class="c1"># SLACK_ATHENA_TOKEN - Bot token for posting</span>
</code></pre></div>
<hr />
<h2 id="utility-functions">Utility Functions<a class="headerlink" href="#utility-functions" title="Permanent link">&para;</a></h2>
<h3 id="parse_chat_transcript">parse_chat_transcript<a class="headerlink" href="#parse_chat_transcript" title="Permanent link">&para;</a></h3>
<p>Parses raw string chat transcript into structured messages.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_chat_transcript</span>

<span class="n">transcript</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Athena: Hello, how can I help?</span>
<span class="s2">User: I have a question about my policy.</span>
<span class="s2">Athena: I&#39;d be happy to help with that.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">messages</span> <span class="o">=</span> <span class="n">parse_chat_transcript</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;Athena&quot;</span><span class="p">)</span>
<span class="c1"># [</span>
<span class="c1">#     {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Hello, how can I help?&quot;},</span>
<span class="c1">#     {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;I have a question about my policy.&quot;},</span>
<span class="c1">#     {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;I&#39;d be happy to help with that.&quot;},</span>
<span class="c1"># ]</span>
</code></pre></div>
<hr />
<h2 id="code-examples">Code Examples<a class="headerlink" href="#code-examples" title="Permanent link">&para;</a></h2>
<h3 id="prompt-management">Prompt Management<a class="headerlink" href="#prompt-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.prompt</span><span class="w"> </span><span class="kn">import</span> <span class="n">LangfusePromptManager</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">LangfusePromptManager</span><span class="p">()</span>

<span class="c1"># Fetch and compile with variables</span>
<span class="n">compiled</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_compiled_prompt</span><span class="p">(</span>
    <span class="s2">&quot;recommendation&quot;</span><span class="p">,</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;case_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="s2">&quot;assessment&quot;</span><span class="p">:</span> <span class="s2">&quot;high-risk&quot;</span><span class="p">},</span>
    <span class="n">strict_mode</span><span class="o">=</span><span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="n">fallback</span><span class="o">=</span><span class="s2">&quot;Default prompt text&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Register for updates</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_update</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prompt </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> updated: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">manager</span><span class="o">.</span><span class="n">on_prompt_change</span><span class="p">(</span><span class="n">on_update</span><span class="p">)</span>
</code></pre></div>
<h3 id="trace-analysis">Trace Analysis<a class="headerlink" href="#trace-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">TraceCollection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">implementations.athena.langfuse.prompt_patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowPromptPatterns</span>

<span class="c1"># Single trace</span>
<span class="n">trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">trace_data</span><span class="p">,</span> <span class="n">prompt_patterns</span><span class="o">=</span><span class="n">WorkflowPromptPatterns</span><span class="p">)</span>
<span class="n">assessment</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">recommendation</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;caseAssessment&quot;</span><span class="p">]</span>
<span class="n">generation_output</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">recommendation</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">output</span>

<span class="c1"># Multiple traces</span>
<span class="n">traces</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">(</span><span class="n">trace_list</span><span class="p">,</span> <span class="n">prompt_patterns</span><span class="o">=</span><span class="n">WorkflowPromptPatterns</span><span class="p">)</span>
<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">important_ids</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">recommendation</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<h3 id="deep-trace-navigation">Deep Trace Navigation<a class="headerlink" href="#deep-trace-navigation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">trace_data</span><span class="p">,</span> <span class="n">prompt_patterns</span><span class="o">=</span><span class="n">WorkflowPromptPatterns</span><span class="p">)</span>

<span class="c1"># Access step</span>
<span class="n">rec</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">recommendation</span>

<span class="c1"># Get generation observation</span>
<span class="n">gen</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">generation</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>   <span class="c1"># Prompt input</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>  <span class="c1"># Model output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>   <span class="c1"># Model used</span>

<span class="c1"># Extract variables (lazy evaluation)</span>
<span class="nb">vars</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">variables</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="s2">&quot;caseAssessment&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="s2">&quot;contextData&quot;</span><span class="p">])</span>

<span class="c1"># Access trace metadata</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">latency</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="exports">Exports<a class="headerlink" href="#exports" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.prompt</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LangfuseSettings</span><span class="p">,</span>
    <span class="n">get_langfuse_settings</span><span class="p">,</span>
    <span class="n">LangfusePromptManager</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.trace</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="c1"># Enums</span>
    <span class="n">ModelUsageUnit</span><span class="p">,</span>
    <span class="n">ObservationLevel</span><span class="p">,</span>

    <span class="c1"># Dataclasses</span>
    <span class="n">Usage</span><span class="p">,</span>

    <span class="c1"># SmartAccess Framework</span>
    <span class="n">SmartAccess</span><span class="p">,</span>
    <span class="n">SmartDict</span><span class="p">,</span>
    <span class="n">SmartObject</span><span class="p">,</span>

    <span class="c1"># Trace Views</span>
    <span class="n">TraceView</span><span class="p">,</span>
    <span class="n">ObservationsView</span><span class="p">,</span>

    <span class="c1"># Pattern Extraction</span>
    <span class="n">create_extraction_pattern</span><span class="p">,</span>
    <span class="n">PromptPatternsBase</span><span class="p">,</span>

    <span class="c1"># Main Classes</span>
    <span class="n">TraceStep</span><span class="p">,</span>
    <span class="n">Trace</span><span class="p">,</span>
    <span class="n">TraceCollection</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.webhook</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">verify_signature</span><span class="p">,</span>
    <span class="n">langfuse_webhook</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">shared.langfuse.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">parse_chat_transcript</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 27, 2026 19:39:46 UTC">January 27, 2026</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 27, 2026 19:39:46 UTC">January 27, 2026</span>
  </span>

    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:matt.evanoff@mgtinsurance.com">Matt Evanoff</a>
    </nav>
  </span>

    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.instant", "navigation.tracking", "navigation.top", "content.code.copy", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>